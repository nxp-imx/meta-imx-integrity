From 59ed8028a367b54f8ae4e74516f7cb02ac3e61e4 Mon Sep 17 00:00:00 2001
From: Kshitiz Varshney <kshitiz.varshney@nxp.com>
Date: Fri, 20 May 2022 08:05:47 +0200
Subject: [PATCH] Config change required for IMA/EVM

This commit configures kernel for IMA/EVM.

Signed-off-by:- Kshitiz Varshney <kshitiz.varshney@nxp.com>
---
 arch/arm64/configs/imx_v8_defconfig | 32 +++++++++++++++++++++++++++--
 1 file changed, 30 insertions(+), 2 deletions(-)

diff --git a/arch/arm64/configs/imx_v8_defconfig b/arch/arm64/configs/imx_v8_defconfig
index 74dc82cb4dde..ca15e93b2eb3 100644
--- a/arch/arm64/configs/imx_v8_defconfig
+++ b/arch/arm64/configs/imx_v8_defconfig
@@ -1014,7 +1014,7 @@ CONFIG_CRYPTO_USER_API_SKCIPHER=m
 CONFIG_CRYPTO_USER_API_RNG=m
 CONFIG_CRYPTO_USER_API_AEAD=m
 CONFIG_CRYPTO_DEV_FSL_CAAM_SECVIO=m
-CONFIG_CRYPTO_DEV_FSL_CAAM=m
+CONFIG_CRYPTO_DEV_FSL_CAAM=y
 CONFIG_CRYPTO_DEV_FSL_CAAM_SM_TEST=m
 CONFIG_CRYPTO_DEV_FSL_DPAA2_CAAM=m
 CONFIG_CRYPTO_DEV_CCREE=m
@@ -1044,7 +1044,35 @@ CONFIG_TLS=y
 CONFIG_TLS_DEVICE=y
 
 # enable Trusted Keys based on CAAM
-CONFIG_TRUSTED_KEYS=m
+CONFIG_TRUSTED_KEYS=y
 CONFIG_TRUSTED_KEYS_TPM=n
 CONFIG_TRUSTED_KEYS_TEE=n
 CONFIG_TRUSTED_KEYS_CAAM=y
+
+#
+# Security options
+#
+CONFIG_SECURE_KEYS=n
+#CONFIG_ENCRYPTED_KEYS=y
+CONFIG_SECURITYFS=y
+CONFIG_IMA=y
+CONFIG_IMA_MEASURE_PCR_IDX=10
+CONFIG_IMA_NG_TEMPLATE=y
+CONFIG_IMA_DEFAULT_TEMPLATE="ima-ng"
+CONFIG_IMA_DEFAULT_HASH_SHA1=y
+CONFIG_IMA_DEFAULT_HASH="sha1"
+CONFIG_IMA_APPRAISE=y
+CONFIG_IMA_APPRAISE_BOOTPARAM=y
+CONFIG_EVM=y
+CONFIG_EVM_ATTR_FSUUID=y
+CONFIG_EVM_ADD_XATTRS=y
+CONFIG_INTEGRITY=y
+CONFIG_INTEGRITY_SIGNATURE=y
+CONFIG_INTEGRITY_AUDIT=y
+CONFIG_IMA_LSM_RULES=y
+CONFIG_IMA_TRUSTED_KEYRING=y
+CONFIG_EXT4_FS_SECURITY=y
+CONFIG_IMA_QUEUE_EARLY_BOOT_KEYS=y
+
+
+CONFIG_IMX_EL_ENCLAVE=y
-- 
2.25.1

